{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.13.7/.schema/devbox.schema.json",
  "packages": [
    "docker@latest",
    "mkpasswd@latest",
    "act"
  ],
  "shell": {
    "init_hook": [
      "echo -e 'Available commands:\n\u001b[32mdevbox run build\u001b[0m: For building the image locally\n\u001b[32mdevbox run test\u001b[0m: For dry-running the CI workflow'"
    ],
    "scripts": {
      "build": [
        "docker build -t ethernix-builder:latest .",
        "docker run --rm -it -v \"$(pwd):/build\" --platform linux/arm64 ethernix-builder:latest sh -c \"mkdir -p out && ./build.sh && find /nix/store -name 'nixos-image-sd-card-*.img.zst' -exec unzstd -d {} -o out/ethernix.img \\; && chown -R $(id -u):$(id -g) out\""
      ],
      "test": [
        "act push -n -P self-hosted=catthehacker/ubuntu:act-runner --container-architecture linux/amd64 --artifact-server-path /tmp/artifacts"
      ]
    }
  }
}
