{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.13.7/.schema/devbox.schema.json",
  "packages": [
    "docker@latest",
    "mkpasswd@latest",
    "act"
  ],
  "shell": {
    "init_hook": [
      "echo 'Welcome to devbox!' > /dev/null"
    ],
    "scripts": {
      "build": [
        "rm ethernix.sd || true",
        "docker build -t ethernix-builder:latest .",
        "docker run --rm -it -v \"$(pwd):/build\" --platform linux/arm64 ethernix-builder:latest sh -c \"mkdir -p out && ./build.sh && find /nix/store -name 'nixos-image-sd-card-*.img.zst' -exec unzstd -d {} -o out/ethernix.img \\; && chown -R $(id -u):$(id -g) out\""
      ],
      "act": [
        "act push -P self-hosted=catthehacker/ubuntu:act-latest --container-architecture linux/amd64"
      ],
      "runner": [
        "chmod +x actions-runner/run.sh",
        "actions-runner/run.sh"
      ],
      "remote-rebuild": [
        "docker build -t ethernix-builder:latest .",
        "docker run --rm -it -v \"$(pwd):/build\" --platform linux/arm64 ethernix-builder:latest /bin/sh -c \"cd /build && dotenvx run -- nixos-rebuild switch --flake .#ethernix --target-host aloshy@\\$REMOTE_HOST --use-remote-sudo\""
      ]
    }
  }
}
